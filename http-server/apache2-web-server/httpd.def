Bootstrap: docker
From: httpd:2.4.37

%help
Apache2 web server running in a Singularity Container.
For full tutorial, visit: https://github.com/sylabs/examples/tree/master/http-server/apache2-web-server

usage:

  setup:
  $ mkdir -p httpd/logs
  $ touch httpd/index.html  # this is your html file.

  starting the instance:
  $ singularity instance start -B httpd/:/srv/httpd/ httpd.sif httpd

  stoping the instance:
  $ singularity instance stop httpd

%runscript
echo "Apache2 web server running in a Singularity Container."
echo "For full tutorial, visit: https://github.com/sylabs/examples/tree/master/http-server/apache2-web-server"
echo
echo "usage:"
echo
echo "  setup:"
echo "  $ mkdir -p httpd/{htdocs,logs}"
echo "  $ touch httpd/htdocs/index.html  # this is your html file."
echo
echo "  starting the instance:"
echo "  $ singularity instance start -B httpd/:/srv/httpd/ httpd.sif httpd"
echo
echo "  stoping the instance:"
echo "  $ singularity instance stop httpd"
echo

%post
# Change the port we are listening on to 8080 instead of 80
sed -ie "s/^\(Listen\).*/\1 8080/" /usr/local/apache2/conf/httpd.conf

# to avoid a error message
sed -ie "s/\#ServerName\ www.example.com:80/ServerName\ localhost/" /usr/local/apache2/conf/httpd.conf

mkdir /srv/httpd
mkdir /srv/httpd/htdocs
mkdir /srv/httpd/logs

rm -rf /usr/local/apache2/htdocs/
ln -s /srv/httpd/htdocs/ /usr/local/apache2/htdocs

rm -rf /usr/local/apache2/logs
ln -s /srv/httpd/logs/ /usr/local/apache2/logs

%startscript
httpd
